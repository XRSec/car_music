# 🎵 课程音乐管理系统

一个功能丰富的 Node.js 音乐文件管理系统，专为课程学习设计。支持"一个课程配两首歌曲"的播放模式，让学习更加有趣！

## ✨ 主要功能

### 🎯 核心特性
- **智能文件映射**：自动扫描课程文件，为每个课程分配两个歌曲位置
- **友好名称管理**：支持给歌曲设置易记的友好名称，方便管理
- **车载播放器优化**：自动重命名文件为数字序号格式（001-xxx.mp3, 002-xxx.mp3...）
- **音乐元数据解析**：自动提取歌曲的标题、艺术家、年份等信息
- **现代化Web界面**：美观的响应式界面，支持多设备访问

### 📊 管理功能
- **概览统计**：显示课程数量、歌曲数量、空闲位置等统计信息
- **课程管理**：查看所有课程及其关联歌曲，支持搜索过滤
- **歌曲管理**：添加、删除、搜索歌曲，支持按友好名称操作
- **批量操作**：一键批量重命名所有文件为播放器友好格式

### 🔧 实用工具
- **歌曲查询**：快速查找指定歌曲的详细信息
- **文件检查**：自动检测缺失的文件
- **播放器兼容**：优化的文件命名确保正确的播放顺序

## 🚀 快速开始

### 安装依赖
```bash
npm install
```

### 启动服务器
```bash
npm start
```

服务器将在 http://localhost:3000 启动

## 📝 使用说明

### 1. 课程文件格式
课程文件应遵循以下命名格式：
- `20170224.mp3` - 标准课程文件
- `20170224-2.mp3` - 同日期的第二个课程

### 2. 车载播放器排序规则
系统会自动将歌曲文件重命名为以下格式以确保正确播放顺序：
```
20170224.mp3      (课程1)
20170224-A.mp3    (歌曲A)
20170224-B.mp3    (歌曲B)
20170225.mp3      (课程2)  
20170225-A.mp3    (歌曲A)
20170225-B.mp3    (歌曲B)
...
```

这样车载播放器会按字母顺序播放：**课程 → A歌曲 → B歌曲 → 下个课程**

### 3. 添加歌曲

#### 🎯 智能自动分配
- **自动分配模式**：不选择课程时，系统自动分配到有空位的课程
- **指定课程模式**：选择特定课程，如果满了会自动转到其他有空位的课程

#### 📁 批量拖拽上传
1. 在"歌曲管理"页面，直接拖拽多个 MP3 文件到拖拽区域
2. 或点击"选择文件"按钮选择多个文件
3. 可选：设置友好名称（用逗号分隔，如"歌曲1,歌曲2,歌曲3"）
4. 点击"批量上传"，系统会：
   - 自动解析每个文件的音乐元数据
   - 智能分配到有空位的课程
   - 重命名为播放器友好格式
   - 显示详细的上传结果

#### 📱 单文件上传
1. 选择目标课程（可选）
2. 上传单个 MP3 文件
3. 设置友好名称（可选）
4. 系统自动处理并分配

### 4. 删除歌曲
- **按友好名称删除**：在删除框中输入歌曲的友好名称
- **按位置删除**：在课程管理页面直接点击删除按钮

### 5. 查询歌曲
在工具页面输入歌曲名称，系统会显示：
- 友好名称
- 所属课程
- 艺术家信息
- 发行年份
- 实际文件名

## 🎨 界面预览

### 📊 概览页面
- 统计卡片显示系统状态
- 最近添加的歌曲列表
- 实时数据更新

### 📚 课程管理
- **分类展示**：按歌曲数量分为三类（有两首、有一首、没有歌曲）
- **折叠功能**：每个分类都可以折叠收起
- **一行显示**：课程信息、元数据、播放按钮在一行显示
- **空位上传**：两个空位在一行，支持直接点击或拖拽上传
- **内嵌播放**：播放器悬浮显示，不新开标签页

### 🎵 歌曲管理
- 文件上传功能
- 搜索和过滤
- 歌曲详细信息展示

### 🔧 工具页面
- 批量重命名功能
- 歌曲查询工具
- 系统维护功能

## 🔗 API 接口

### 统计信息
```
GET /api/stats
```

### 课程和歌曲列表
```
GET /api/list
```

### 添加歌曲
```
POST /api/add-song
Content-Type: multipart/form-data
{
  course: "课程文件名(可选，不填则自动分配)",
  song: "音乐文件",
  friendly_name: "友好名称(可选)"
}
```

### 批量添加歌曲
```
POST /api/add-songs-batch
Content-Type: multipart/form-data
{
  course: "课程文件名(可选，不填则自动分配)",
  songs: "多个音乐文件",
  friendly_names: "友好名称列表，用逗号分隔(可选)"
}
```

### 删除歌曲
```
POST /api/remove-song-by-name
Content-Type: application/json
{
  "friendly_name": "歌曲友好名称"
}
```

### 查询歌曲
```
GET /api/song-exists?name=歌曲名称
```

### 批量重命名
```
POST /api/batch-rename
```

## 📁 文件结构

```
/workspace/
├── server.js          # 主服务器文件
├── music-map.json     # 音乐映射数据库
├── package.json       # 项目配置
├── *.mp3             # 音乐文件
└── README.md         # 使用说明
```

## 🛠️ 技术栈

- **后端**：Node.js + Express
- **文件处理**：Multer
- **音乐元数据**：music-metadata
- **前端**：原生 HTML/CSS/JavaScript
- **数据存储**：JSON 文件

## 💡 使用建议

1. **文件备份**：定期备份 `music-map.json` 文件
2. **命名规范**：保持课程文件的日期命名格式
3. **批量操作**：添加多个歌曲后使用批量重命名功能
4. **定期清理**：使用统计功能检查缺失文件并及时清理
5. **避免重复**：系统已自动防止重复添加相同文件
6. **清空列表**：上传前如有问题可点击"清空列表"重置

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 📄 许可证

MIT License